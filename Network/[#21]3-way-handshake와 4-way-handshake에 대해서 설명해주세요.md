# 3-way-handshake와 4-way-handshake에 대해서 설명해주세요

## 1. 3 way Handshake란?

    TCP/IP 프로토콜을 이용하여 통신을 진행할 때, 두 종단 간 정확한 데이터 전송을 보장하기 위해 연결을 설정하는 과정이다.

    연결 과정 : 

    - 클라이언트가 서버에게 접속을 요청하는 SYN(a)패킷을 보냄
    - 서버는 요청 수락 응답으로 ACK(a+1)패킷과 클라이언트도 포트를 열어달라는 SYN(b)패킷을 보냄
    - 클라이언트는 ACK(a+1) 패킷과 SYN(b)패킷을 받고 응답으로 ACK(b+1)패킷을 보내여 연결 성립

    ⇒ 양 쪽 모두 데이터를 전송할 준비가 되었다는 것을 보장하고, 데이터를 전송하기 전에 한쪽이 다른쪽의 준비를 확인하는 과정이다.

## 2. 4 way Handshake란?

    3 way Handshake와는 반대로 통신연결을 해제하는 과정이다.

    해제 과정 : 

    - 클라이언트는 서버에게 연결을 종료하겠다는 FIN 패킷을 보냄
    - 서버는 FIN 패킷에 대한 응답으로 ACK 패킷을 보냄
    - 서버는 처리해야 할 통신이 끝나면 연결을 종료하겠다는 FIN 패킷을 보냄
    - 클라이언트는 FIN 패킷에 대한 응답으로 ACK 패킷을 보냄
    - 클라이언트의 응답을 받은 서버는 소캣 연결을 닫음.
    - 클라이언트는 아직 서버로부터 받지 못한 데이터가 있을것을 대비해 기다리는 과정을 거치고 (TIME_WAIT) 연결을 닫음.

## 3. 왜 사용하는가?

    TCP/IP 통신 연결에서 정확한 데이터 통신을 위해 사용한다.

    즉, 신호(데이터)를 보내면 잘 받았는지 응답, 확인하면서 통신의 신뢰도를 확실히 하기위해 사용한다.

## 4. 왜 2 way가 아닌 3 way인가?

    TCP는 양방향성 통신이다.

    따라서 클라이언트만 서버에 신호를 보내 존재를 알리고 통신하는 것이 아니라,

    서버도 클라이언트에 존재를 알리고 통신이 가능함을 알려야 한다.

    그래서 양방향통신확인 3 way handshake를 사용한다.

## 5. 왜 ISN으로 난수를 사용하는가?

    통신 연결을 할 때, 포트는 유효 범위 내에서 사용되고 시간이 지나면 재사용된다.

    서버는 패킷의 SYN을 보고 패킷을 구분하는데, 난수가 아니라 순차적인 번호를 이용한다면 이전의 연결에서 오는 패킷으로 오인할 수 있다.

    이러한 인식 문제를 해결하기 위해 난수를 사용한다.